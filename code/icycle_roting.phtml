<script type="text/javascript">
!function(e){function t(e){return 180*e/Math.PI}function i(e){return-1!=e.indexOf("deg")?parseInt(e,10)*(2*Math.PI/360):-1!=e.indexOf("grad")?parseInt(e,10)*(Math.PI/200):parseFloat(e)}var r=document.createElement("div"),a=r.style,o=e.support;o.transform=""===a.MozTransform?"MozTransform":""===a.MsTransform?"MsTransform":""===a.WebkitTransform?"WebkitTransform":""===a.OTransform?"OTransform":!1,o.matrixFilter=!o.transform&&""===a.filter,r=null,e.cssNumber.rotate=!0,e.cssHooks.rotate={set:function(t,r){var a,n,s,d=o,l=d.transform;"string"==typeof r&&(r=i(r)),e.data(t,"transform",{rotate:r}),l?t.style[l]="rotate("+r+"rad)":d.matrixFilter&&(a=Math.cos(r),n=Math.sin(r),t.style.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11="+a+",","M12="+-n+",","M21="+n+",","M22="+a+",","SizingMethod='auto expand'",")"].join(""),(s=e.rotate.centerOrigin)&&(t.style["margin"==s?"marginLeft":"left"]=-(t.offsetWidth/2)+t.clientWidth/2+"px",t.style["margin"==s?"marginTop":"top"]=-(t.offsetHeight/2)+t.clientHeight/2+"px"))},get:function(t,i){var r=e.data(t,"transform");return r&&r.rotate?r.rotate:0}},e.fx.step.rotate=function(t){e.cssHooks.rotate.set(t.elem,t.now+t.unit)},e.rotate={centerOrigin:"margin",radToDeg:t}}(jQuery),function(e){e.fn.rotationSlider=function(t){void 0==t&&(t={});var r=e(this),a=r.children(),o=a.length;if(void 0==t.width&&(t.width=1e3),void 0==t.height&&(t.height=300),void 0==t.rotate&&(t.rotate=90),void 0==t.controller&&(t.controller=!0),t.controller&&(void 0==t.prev&&(t.prev=".rotation-prev"),void 0==t.next&&(t.next=".rotation-next")),void 0==t.pager&&(t.pager=!0),void 0==t.auto&&(t.auto=0),void 0==t.resize&&(t.resize=!1),t.pager&&(void 0==t.pagerDom&&(t.pagerDom=".rotation-slider-pager"),flagDomPager="rotation-pager"),t.resize&&e(t.resize).length){var n=t.width/t.height;e(window).resize(function(i){widthResize=e(t.resize).outerWidth(),heightResize=widthResize/n,r.width(widthResize),r.height(heightResize)}),widthResize=e(t.resize).outerWidth(),heightResize=widthResize/n,r.width(widthResize),r.height(heightResize)}if(slideItemActive=r.children(".active"),1!=slideItemActive.length&&(slideItemActive=a.first()),slideItemActive.addClass("active"),slideItemActive.siblings().removeClass("active").hide(),slideItemActive.show(),e.support.transform?(a.css("rotate",function(e){return-t.rotate*e+"deg"}),r.bind("rotateJump",function(i,s,d){indexActive=slideItemActive.index(),null==s&&(s="next"==d?indexActive+1:indexActive-1),s!=indexActive&&(s>=o?s=0:0>s&&(s=o-1),t.pager&&(e(t.pagerDom+" ."+flagDomPager+" a").removeClass("active"),e(t.pagerDom+" ."+flagDomPager+" a").eq(s).addClass("active")),widthResize=0,heightResize=0,t.resize&&e(t.resize).length&&(widthResize=e(t.resize).outerWidth(),heightResize=widthResize/n),widthResize||(widthResize=t.width,heightResize=t.height),r.animate({width:widthResize,height:heightResize},"fast",function(){slideItemActive.removeClass("active"),slideItemActive.fadeOut("slow",function(){slideItemActiveNew=a.eq(s),slideItemActiveNew.fadeIn("slow"),slideItemActive=slideItemActiveNew,slideItemActive.addClass("active")}),s>indexActive?rotate=t.rotate:rotate=-t.rotate,r.animate({rotate:Math.round(e.rotate.radToDeg(r.css("rotate"))+rotate)+"deg"},"slow").animate({width:widthResize,height:heightResize},"fast")}))})):r.bind("rotateJump",function(i,r,n){indexActive=slideItemActive.index(),null==r&&(r="next"==n?indexActive+1:indexActive-1),r!=indexActive&&(r>=o?r=0:0>r&&(r=o-1),t.pager&&(e(t.pagerDom+" ."+flagDomPager+" a").removeClass("active"),e(t.pagerDom+" ."+flagDomPager+" a").eq(r).addClass("active")),slideItemActive.removeClass("active"),slideItemActive.fadeOut("slow",function(){slideItemActiveNew=a.eq(r),slideItemActiveNew.fadeIn("slow"),slideItemActive=slideItemActiveNew,slideItemActive.addClass("active")}),r>indexActive?rotate=t.rotate:rotate=-t.rotate)}),t.pager){for(pagerHtml="",pagerHtml+='<ul class="'+flagDomPager+'">',indexActive=slideItemActive.index(),i=0;i<o;i++)pagerHtml+="<li>",pagerHtml+='<a href="#"',i==indexActive&&(pagerHtml+=' class="active"'),pagerHtml+=">",pagerHtml+="",pagerHtml+="</a>",pagerHtml+="</li>";pagerHtml+="</ul>",e(t.pagerDom).html(pagerHtml)}e(document).on("click",t.prev,function(e){return e.preventDefault(),r.is(":animated")?!1:void r.trigger("rotateJump",[null,"prev"])}),e(document).on("click",t.next,function(e){return e.preventDefault(),r.is(":animated")?!1:void r.trigger("rotateJump",[null,"next"])}),t.pager&&e(document).on("click",t.pagerDom+" ."+flagDomPager+" a",function(t){return t.preventDefault(),r.is(":animated")?!1:(indexActive=e(this).parent().index(),void r.trigger("rotateJump",indexActive))}),t.auto>0&&setInterval(function(e){r.is(":animated")||r.trigger("rotateJump",[null,"next"])},t.auto)}}(jQuery);
</script>
<style>
.rotation-slider-container{
    position:relative;
}
.rotation-slider{
    position:absolute;
    z-index:100;
}
.rotation-slider .rotation-item{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}
.rotation-pager{
    margin-top: 100px;
    position: absolute;
}
.rotation-pager a{
    width: 12px;
    height: 12px;
    display: block;
    outline: none;
    border: none;
    position: relative;
    z-index: 2;
    background: #aaa;
    box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -moz-box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -webkit-box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
}
.rotation-pager a.active{
    background: #777;
}
</style>

<?php $item = $this->getBanner(); ?>
<?php
    if (!is_object($item)) {
        return;
    }
    $_helper = $this->helper('icycle');
    $_iHelper = $this->helper('icycle/image');
    $suffix = md5(microtime() . mt_rand());
    $_imageList = $item->getImageListForFrontend();
    if (!is_array($_imageList) || !sizeof($_imageList)) {
        return;
    }
    $width = $item->getWidth() ? $item->getWidth() : 960;
    $height = $item->getHeight() ? $item->getHeight() : 474;
?>
<div class="rotation-wrapper">
  <div class="rotation-slider-container" style="width: <?php echo $width; ?>px;">
      <?php if($item->getExtraOption('navigation') != 'false') : ?>
          <div class="slider-rotation-controller">
              <div class="controller-inner">
                  <a class="rotation-prev rotation-prev-<?php echo $suffix; ?>" href="#"><span>Prev</span></a>
                  <a class="rotation-next rotation-next-<?php echo $suffix; ?>" href="#"><span>Next</span></a>
              </div>
          </div>
      <?php endif; ?>
      <ul class="rotation-slider rotation-slider-<?php echo $suffix; ?>" style="width: <?php echo $width; ?>px; height: <?php echo $height; ?>px;">
          <?php foreach ($_imageList as &$_item): ?>
              <?php if ( $size = $_helper->getThumbSize($_item['file'], $width, $height) ) : ?>
                  <?php $thumb = $_iHelper->init($_item['file'])->resize($size->getWidth(), $size->getHeight()); ?>
                  <li class="rotation-item">
                      <img src="<?php echo $thumb; ?>" />
                      <?php if (isset($_item['description'][0])) : ?>
                          <div class="icycle-description">
                              <div class="id-inner"><?php echo $_helper->parseText($_item['description']); ?></div>
                          </div>
                      <?php endif; ?>
                  </li>
              <?php endif; ?>
          <?php endforeach; ?>
      </ul>
      <div class="rotation-slider-pager rotation-pager-<?php echo $suffix; ?>"></div>
  </div>
</div>
<script type="text/javascript">
    jQuery(document).ready(function($) {
        <?php if($item->getExtraOption('navigation') == false) : ?>
            $('.rotation-slider-<?php echo $suffix; ?>').siblings('.slider-rotation-controller').remove();
        <?php endif; ?>
        $('.rotation-slider-<?php echo $suffix; ?>').rotationSlider({
            width: <?php echo $width; ?>,
            height: <?php echo $height; ?>,
            rotate: 360,
            auto: <?php echo $item->getExtraOption('time'); ?>,
            controller: <?php echo $item->getExtraOption('navigation'); ?>,
            prev: '.rotation-prev-<?php echo $suffix; ?>',
            next: '.rotation-next-<?php echo $suffix; ?>',
            pager: <?php echo $item->getExtraOption('pagination'); ?>,
            pagerDom: '.rotation-pager-<?php echo $suffix; ?>',
            resize: '.rotation-wrapper'
        });
    });
</script>
