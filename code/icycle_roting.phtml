<script type="text/javascript">
!function(e){function t(e){return 180*e/Math.PI}function i(e){return-1!=e.indexOf("deg")?parseInt(e,10)*(2*Math.PI/360):-1!=e.indexOf("grad")?parseInt(e,10)*(Math.PI/200):parseFloat(e)}var a=document.createElement("div"),r=a.style,n=e.support;n.transform=""===r.MozTransform?"MozTransform":""===r.MsTransform?"MsTransform":""===r.WebkitTransform?"WebkitTransform":""===r.OTransform?"OTransform":!1,n.matrixFilter=!n.transform&&""===r.filter,a=null,e.cssNumber.rotate=!0,e.cssHooks.rotate={set:function(t,a){var r,o,s,l=n,d=l.transform;"string"==typeof a&&(a=i(a)),e.data(t,"transform",{rotate:a}),d?t.style[d]="rotate("+a+"rad)":l.matrixFilter&&(r=Math.cos(a),o=Math.sin(a),t.style.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11="+r+",","M12="+-o+",","M21="+o+",","M22="+r+",","SizingMethod='auto expand'",")"].join(""),(s=e.rotate.centerOrigin)&&(t.style["margin"==s?"marginLeft":"left"]=-(t.offsetWidth/2)+t.clientWidth/2+"px",t.style["margin"==s?"marginTop":"top"]=-(t.offsetHeight/2)+t.clientHeight/2+"px"))},get:function(t){var i=e.data(t,"transform");return i&&i.rotate?i.rotate:0}},e.fx.step.rotate=function(t){e.cssHooks.rotate.set(t.elem,t.now+t.unit)},e.rotate={centerOrigin:"margin",radToDeg:t}}(jQuery),function(e){e.fn.rotationSlider=function(t){void 0==t&&(t={});var a=e(this),r=a.children(),n=r.length;if(void 0==t.width&&(t.width=1e3),void 0==t.height&&(t.height=300),void 0==t.rotate&&(t.rotate=90),void 0==t.controller&&(t.controller=!0),t.controller&&(void 0==t.prev&&(t.prev=".rotation-prev"),void 0==t.next&&(t.next=".rotation-next")),void 0==t.pager&&(t.pager=!0),void 0==t.auto&&(t.auto=0),t.pager&&(void 0==t.pagerDom&&(t.pagerDom="rotation-slider-pager"),flagDomPager="rotation-pager"),slideItemActive=a.children(".active"),1!=slideItemActive.length&&(slideItemActive=r.first()),slideItemActive.addClass("active"),slideItemActive.siblings().removeClass("active").hide(),slideItemActive.show(),e.support.transform?(r.css("rotate",function(e){return-t.rotate*e+"deg"}),a.bind("rotateJump",function(i,o,s){indexActive=slideItemActive.index(),null==o&&(o="next"==s?indexActive+1:indexActive-1),o!=indexActive&&(o>=n?o=0:0>o&&(o=n-1),t.pager&&(e("."+flagDomPager+" a").removeClass("active"),e("."+flagDomPager+" a").eq(o).addClass("active")),a.animate({width:t.width,height:t.height},"fast",function(){slideItemActive.removeClass("active"),slideItemActive.fadeOut("slow",function(){slideItemActiveNew=r.eq(o),slideItemActiveNew.fadeIn("slow"),slideItemActive=slideItemActiveNew,slideItemActive.addClass("active")}),rotate=o>indexActive?t.rotate:-t.rotate,a.animate({rotate:Math.round(e.rotate.radToDeg(a.css("rotate"))+rotate)+"deg"},"slow").animate({width:t.width,height:t.height},"fast")}))})):a.bind("rotateJump",function(i,a,o){indexActive=slideItemActive.index(),null==a&&(a="next"==o?indexActive+1:indexActive-1),a!=indexActive&&(a>=n?a=0:0>a&&(a=n-1),t.pager&&(e("."+flagDomPager+" a").removeClass("active"),e("."+flagDomPager+" a").eq(a).addClass("active")),slideItemActive.removeClass("active"),slideItemActive.fadeOut("slow",function(){slideItemActiveNew=r.eq(a),slideItemActiveNew.fadeIn("slow"),slideItemActive=slideItemActiveNew,slideItemActive.addClass("active")}),rotate=a>indexActive?t.rotate:-t.rotate)}),t.pager){for(pagerHtml="",pagerHtml+='<ul class="'+flagDomPager+'">',indexActive=slideItemActive.index(),i=0;n>i;i++)pagerHtml+="<li>",pagerHtml+='<a href="#"',i==indexActive&&(pagerHtml+=' class="active"'),pagerHtml+=">",pagerHtml+="",pagerHtml+="</a>",pagerHtml+="</li>";pagerHtml+="</ul>",e(t.pagerDom).html(pagerHtml)}e(document).on("click",t.prev,function(e){return e.preventDefault(),a.is(":animated")?!1:void a.trigger("rotateJump",[null,"prev"])}),e(document).on("click",t.next,function(e){return e.preventDefault(),a.is(":animated")?!1:void a.trigger("rotateJump",[null,"next"])}),t.pager&&e(document).on("click","."+flagDomPager+" a",function(t){return t.preventDefault(),a.is(":animated")?!1:(indexActive=e(this).parent().index(),void a.trigger("rotateJump",indexActive))}),t.auto>0&&setInterval(function(){a.is(":animated")||a.trigger("rotateJump",[null,"next"])},t.auto)}}(jQuery);
</script>
<style>
.rotation-slider-container{
    position:relative;
}
.rotation-slider{
    position:absolute;
    z-index:100;
}
.rotation-slider .rotation-item{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
}
.rotation-pager{
    margin-top: 100px;
    position: absolute;
}
.rotation-pager a{
    width: 12px;
    height: 12px;
    display: block;
    outline: none;
    border: none;
    position: relative;
    z-index: 2;
    background: #aaa;
    box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -moz-box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -webkit-box-shadow: inset 0 1px 1px 0px rgba(0, 0, 0, 0.6), 0px 1px 1px 0px white;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
}
.rotation-pager a.active{
    background: #777;
}
</style>

<?php $item = $this->getBanner(); ?>
<?php if (is_object($item)) : ?>
    <?php $_helper = $this->helper('icycle'); ?>
    <?php $_iHelper = $this->helper('icycle/image'); ?>
    <?php $suffix = md5(microtime() . mt_rand()) ?>
    <?php $_imageList = $item->getImageListForFrontend(); ?>
    <?php if (is_array($_imageList) and sizeof($_imageList) > 0) : ?>
        <?php
            $width = $item->getWidth() ? $item->getWidth() : 960;
            $height = $item->getHeight() ? $item->getHeight() : 474;
        ?>

<div class="rotation-slider-container">
    <div class="slider-rotation-controller">
        <div class="controller-inner">
            <a class="rotation-prev rotation-prev-<?php echo $suffix; ?>" href="#"><span>Prev</span></a>
            <a class="rotation-next rotation-next-<?php echo $suffix; ?>" href="#"><span>Next</span></a>
        </div>
    </div>
    <ul class="rotation-slider rotation-slider-<?php echo $suffix; ?>">
        <?php foreach ($_imageList as &$_item): ?>
            <?php if ( $size = $_helper->getThumbSize($_item['file'], $width, $height) ) : ?>
                <?php $thumb = $_iHelper->init($_item['file'])->resize($size->getWidth(), $size->getHeight()); ?>
                <li class="rotation-item">
                    <img src="<?php echo $thumb; ?>" />
                    <?php if (isset($_item['description'][0])) : ?>
                        <div class="icycle-description">
                            <div class="id-inner"><?php echo $_helper->parseText($_item['description']); ?></div>
                        </div>
                    <?php endif; ?>
                </li>
            <?php endif; ?>
        <?php endforeach; ?>
    </ul>
    <div class="rotation-slider-pager"></div>
</div>
<script type="text/javascript">
    jQuery(document).ready(function($) {
        $('.rotation-slider-<?php echo $suffix; ?>').rotationSlider({
            width: <?php echo $width; ?>,
            height: <?php echo $height; ?>,
            rotate: 360,
            auto: <?php echo $item->getExtraOption('time') ?>,
            prev: '.rotation-prev-<?php echo $suffix; ?>',
            next: '.rotation-next-<?php echo $suffix; ?>',
            pager: true, //default
            pagerDom: '.rotation-slider-pager'//default
        });
    });
</script>
<?php endif; ?>
<?php endif; ?>
